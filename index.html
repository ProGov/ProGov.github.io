<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Signed-in Page</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script type="module/javascript" src="/js/config.js"></script>
		
		<script type="text/javascript" language="javascript" src="js/time.js"></script>    
		
		<link rel="stylesheet" type="text/css" href="css/table.css">     
        <link rel="stylesheet" type="text/css" href="css/heading.css"> 
		
		<script type="text/javascript" language="javascript">
			//Functions
			function query(URL, accessToken) {
				var req = new XMLHttpRequest();
					
				req.open("GET", URL, false);
				req.setRequestHeader("Authorization", "bearer " + accessToken);			
				req.send(null);
				
				return req.responseText;
			}
			
			function queryResponse(URL, accessToken) {
			
				var response = query(URL, accessToken);	
				var data = JSON.parse(response);
				
				var events = [];
				
				for(var i = 0; i < data["value"].length; i++) {
					//Retrieve Data
					var s = data["value"][i]["subject"];
					var sDateTime = data["value"][i]["start"]["dateTime"];
					var sTimeZone = data["value"][i]["start"]["timeZone"];
					var eDateTime = data["value"][i]["end"]["dateTime"];	
					var eTimeZone = data["value"][i]["end"]["timeZone"];
					var oName = data["value"][i]["organizer"]["emailAddress"]["name"];			
					var oEmailAddress = data["value"][i]["organizer"]["emailAddress"]["address"];
					//Store Data
					var event = {subject: s,
							startDateTime: sDateTime,
							startTimeZone: sTimeZone,
							endDateTime: eDateTime,
							endTimeZone: eTimeZone,
							organizerName: oName, 
							organizerEmailAddress: oEmailAddress
					};	
					events.push(event);
				}
		
				for(var i = 0; i < events.length; i++) {
					var dt = new Date(events[i].startDateTime);
					
					for(var  j = 6; j < 18; j++) {
						if(j == dt.getHours()) {
							document.getElementById("bRow" + j).innerHTML = events[i].subject;
						}
					}
				}
			}
			
			function auth() {
				window.location.href = 'https://login.microsoftonline.com/cccbf502-6b91-40d6-be02-5ffa0eb711d6/oauth2/v2.0/authorize?client_id=33177856-90b2-4115-858a-6aeaace22739&response_type=id_token+token&redirect_uri=http%3A%2F%2Flocalhost%3a%2Findex.html&scope=openid%20https%3A%2F%2Fgraph.microsoft.com%2Fuser.read%20https%3A%2F%2Fgraph.microsoft.com%2Fcalendars.read%20https%3A%2F%2Fgraph.microsoft.com%2Fcalendars.read.shared&response_mode=fragment&state=0&nonce=7362CAEA-9CA5-4B43-9BA3-34D7C303EBA7';
			}
		</script>
	</head>

	<body>
		<div class="container-fluid">
            <div class="row">
                <div class="col-lg-12 col-xs-12 col-md-12">
                    <div class="heading stick-top">
                        <img src="https://www.bbd.co.za/wp-content/uploads/2018/03/BBD-logo.png" alt="im"  align="left"/>
                        <span class="title">
                            <span class="clock" id="clock">Clock Section</span>
                        </span>
                    </div>
                </div>  
            </div>
            <div class="row">
                <div class="col-lg-12 col-xs-12 col-md-12 table-responsive">
                    <table class="table table-dark table-hover table-responsive">
                        <thead class="thead-dark">
                            <tr>
                                <th colspan="2">
                                    <span class="roomname">ROOM NAME GOES HERE</span>
                                </th>
                            <tr>            
                                <th class="time">TIME</th>
                                <th>BOOKING</th>
                            </tr>
                        </thead>
                        <tbody>                           
                            <tr>
                                <td class="tRow7" id="tRow7">07:00</td>
                                <td class="bRow7" id="bRow7"></td>
                            </tr>
                            <tr>
                                <td class="tRow8" id="tRow8">08:00</td>
                                <td class="bRow8" id="bRow8"></td>
                            </tr>
                            <tr>
                                <td class="tRow9" id="tRow9">09:00</td>
                                <td class="bRow9" id="bRow9"></td>
                            </tr>
                            <tr>
                                <td class="tRow10" id="tRow10">10:00</td>
                                <td class="bRow10" id="bRow10"></td>
                            </tr>
                            <tr>
                                <td class="tRow11" id="tRow11">11:00</td>
                                <td class="bRow11" id="bRow11"></td>
                            </tr>
                            <tr>
                                <td class="tRow12" id="tRow12">12:00</td>
                                <td class="bRow12" id="bRow12"></td>
                            </tr>
                            <tr>
                                <td class="tRow13" id="tRow13">13:00</td>
                                <td class="bRow13" id="bRow13"></td>
                            </tr>
                            <tr>
                                <td class="tRow14" id="tRow14">14:00</td>
                                <td class="bRow14" id="bRow14"></td>
                            </tr>
                            <tr>
                                <td class="tRow15" id="tRow15">15:00</td>
                                <td class="bRow15" id="bRow15"></td>
                            </tr>
                            <tr>
                                <td class="tRow16" id="tRow16">16:00</td>
                                <td class="bRow16" id="bRow16"></td>
                            </tr>
                            <tr>
                                <td class="tRow17" id="tRow17">17:00</td>
                                <td class="bRow17" id="bRow17"></td>
                            </tr>
                            <tr>
                                <td class="tRow18" id="tRow18">18:00</td>
                                <td class="bRow18" id="bRow18"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>  
        </div>
        <script type="text/javascript" language="javascript" src="js/startTime.js"></script>
		<script type="text/javascript" language="javascript">
			var token_full = window.location.hash.substr(1);
			var fragment = token_full.split("&");
			var access_token = fragment[0].replace("access_token=", "");
			
			if(access_token == "") {
				auth();
			}
			var t = setInterval("queryResponse('https://graph.microsoft.com/v1.0/cccbf502-6b91-40d6-be02-5ffa0eb711d6/users/flex@bbd.co.za/calendar/events?$select=subject%2corganizer%2cstart%2cend', access_token)", 10000);
		</script>

	</body>
</html>