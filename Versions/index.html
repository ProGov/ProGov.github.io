<!DOCTYPE html>
<html lang="en">
<head>
    <title>Signed-in Page</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" language="javascript" src="js/time.js"></script>
    <script type="module/javascript" src="/js/config.js"></script>
    <link rel="stylesheet" type="text/css" href="css/table.css">     
    <link rel="stylesheet" type="text/css" href="css/heading.css"> 
</head>

<body>

    <script>
		function getCurrentDate() {
			var today = new Date();
			var dd = today.getDate();
			var mm = today.getMonth()+1; //January is 0!
			var yyyy = today.getFullYear();
			
			if(dd<10) {
			    dd = '0'+dd
			} 
			
			if(mm<10) {
			    mm = '0'+mm
			} 

			today = yyyy + '-' + mm + '-' + dd;
			console.log(today);
			return today;
		}

		function query(URL, a_t) {
            var req = new XMLHttpRequest();
            req.open("GET", URL, false);
            req.setRequestHeader("Authorization", "bearer " + a_t);
            req.send(null);
            return req.responseText;
        }

        function queryResponse(URL, a_t) {
            var response = query(URL, a_t);
            var response_object = JSON.parse(response);
            // console.log(response_object);

            // var first = response_object["value"][0];
            // console.log(first);
            // var first_subject = response_object["value"][0]["subject"];
            // console.log(first_subject);
            // var first_start = response_object["value"][0]["start"]["dateTime"];
            // console.log(first_start);
            // var first_end = response_object["value"][0]["end"]["dateTime"];
            // console.log(first_end);

            var subjects = [];
            var start_times = [];
            var end_times = [];
            var organisers = [];
            var td = getCurrentDate();
            td = "2018-07-03";
            for (i in response_object["value"]){
            	// temp = response_object["value"][i]["start"]["dateTime"].split("T")[0];
            	// if (temp == td) {
            	// 	console.log(temp);
            	// 	subjects.push(response_object["value"][i]["subject"]);
            	// 	start_times.push(response_object["value"][i]["start"]["dateTime"]);
            	// 	end_times.push(response_object["value"][i]["end"]["dateTime"]);
            	// 	organisers.push(response_object["value"][i]["organizer"]["emailAddress"]["name"]);
             //    	console.log(subjects[i]);
             //    	console.log(organisers[i]);
            	// 	console.log(start_times[i]);
            	// 	console.log(end_times[i]);
            	// }


            	//console.log(temp);
            	subjects.push(response_object["value"][i]["subject"]);
            	start_times.push(response_object["value"][i]["start"]["dateTime"]);
            	end_times.push(response_object["value"][i]["end"]["dateTime"]);
            	organisers.push(response_object["value"][i]["organizer"]["emailAddress"]["name"]);
             	console.log(subjects[i]);
             	console.log(organisers[i]);
            	console.log(start_times[i]);
            	console.log(end_times[i]);
            }
            populateTable(subjects, organisers, start_times, end_times);
        }

        function populateTable(subj, org, st, et) {
        	var hourly_events = [[],[],[],[],[],[],[],[],[],[],[],[]]; //a 12 elt 2d array for the hourly slots
        	var t1 = 0;
        	var t2 = 0;
        	var h1 = 0;
        	var h2 = 0;
        	var m1 = 0;
        	var m2 = 0;
        	var x;
        	var y;
        	//sort events by their start times
        	for (x = 0; x < (st.length - 1); x++) {
        		for (y = 0; y < (st.length - 1); y++) {
        			t1 = st[y].split("T")[1];
        			h1 = t1.split(":")[0];
        			t2 = st[y+1].split("T")[1];
        			h2 = t2.split(":")[0];
        			if (h1 > h2) {
        				//check hours
        				//swap positions in all arrays
        				var tmp = subj[y];
        				subj[y] = subj[y+1];
        				subj[y+1] = tmp;
        				tmp = org[y];
        				org[y] = org[y+1];
        				org[y+1] = tmp;
        				tmp = st[y];
        				st[y] = st[y+1];
        				st[y+1] = tmp;
        				tmp = et[y];
        				et[y] = et[y+1];
        				et[y+1] = tmp;
        			}
        			else if (h1 == h2) {
        				m1 = t1.split(":")[1];
        				m2 = t2.split(":")[1];
        				if (m1 > m2) {
        					//check hours
        					//swap positions in all arrays
        					var tmp = subj[y];
	        				subj[y] = subj[y+1];
	        				subj[y+1] = tmp;
	        				tmp = org[y];
	        				org[y] = org[y+1];
	        				org[y+1] = tmp;
	        				tmp = st[y];
	        				st[y] = st[y+1];
	        				st[y+1] = tmp;
	        				tmp = et[y];
	        				et[y] = et[y+1];
	        				et[y+1] = tmp;

        				}
        			}

        		}
        	}

			//logging to check if the sort works
			var i;
			for (i = 0; i < st.length; i++) {
				console.log(st[i]);
			}

        	// for x in range(len(distances)-1):
		       //  for y in range(len(distances)-1):
		       //      if distances[y] > distances[y+1]:
		       //          distances[y], distances[y+1] = distances[y+1], distances[y]
		       //          trainingLabels[y], trainingLabels[y+1] = trainingLabels[y+1], trainingLabels[y]
        }

        
    </script>

    <h2>Signed-in Page (Query Page)</h2>

    <button onclick="queryResponse('https://graph.microsoft.com/v1.0/cccbf502-6b91-40d6-be02-5ffa0eb711d6/users/Assembly@bbd.co.za/calendar/events?$select=subject%2corganizer%2cstart%2cend', access_token)">Query Tester</button>

    <script>
        var token_full = window.location.hash.substr(1);
        // console.log(token_full);
        var fragment = token_full.split("&");
        // console.log(fragment);

        var access_token = fragment[0].replace("access_token=", "");

    </script>



    <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12 col-xs-12 col-md-12">
                    <div class="heading stick-top">
                        <img src="https://www.bbd.co.za/wp-content/uploads/2018/03/BBD-logo.png" alt="im"  align="left"/>
                        <span class="title">
                            <span class="clock" id="clock">Clock Section</span>
                            </span>
                    </div>
                </div>  
            </div>
            <div class="row">
                <div class="col-lg-12 col-xs-12 col-md-12 table-responsive">
                    <table class="table table-dark table-hover table-responsive">
                        <thead class="thead-dark">
                            <tr>
                                <th colspan="2">
                                    <span class="roomname">Room name goes here</span>
                                </th>
                            <tr>            
                                <th>Time</th>
                                <th>Booking</th>
                            </tr>
                        </thead>
                        <tbody>                           
                            <tr>
                                <td>07:00</td>
                                <td id="b07">___</td>
                            </tr>
                            <tr>
                                <td>08:00</td>
                                <td id="b08">___</td>
                            </tr>
                            <tr>
                                <td>09:00</td>
                                <td id="b09">___</td>
                            </tr>
                            <tr>
                                <td>10:00</td>
                                <td id="b10">___</td>
                            </tr>
                            <tr>
                                <td>11:00</td>
                                <td id="b11">___</td>
                            </tr>
                            <tr>
                                <td>12:00</td>
                                <td id="b12">___</td>
                            </tr>
                            <tr>
                                <td>13:00</td>
                                <td id="b13">___</td>
                            </tr>
                            <tr>
                                <td>14:00</td>
                                <td id="b14">___</td>
                            </tr>
                            <tr>
                                <td>15:00</td>
                                <td id="b15">___</td>
                            </tr>
                            <tr>
                                <td>16:00</td>
                                <td id="b16">___</td>
                            </tr>
                            <tr>
                                <td>17:00</td>
                                <td id="b17">___</td>
                            </tr>
                            <tr>
                                <td>18:00</td>
                                <td id="b18">___</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>  
        </div>
        <script type="text/javascript" language="javascript" src="js/startTime.js"></script>
        <script> document.getElementById('b12').innerHTML = "this is too <br /> a test" </script>


</body>

</html>